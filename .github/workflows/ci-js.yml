name: CI (Node)
on:
    push:
        branches: [main]
        paths-ignore:
            - '**/*.md'
            - '**/*.yml'
            - '**/*.rs'
            - '**/Cargo.toml'
            - 'Cargo.lock'
            - 'rust-toolchain.toml'
            - '.taplo.toml'
            - '!.github/workflows/ci-js.yml'
    pull_request:
        branches: [main]
        types: [opened, synchronize]
        paths-ignore:
            - '**/*.md'
            - '**/*.yml'
            - '**/*.rs'
            - '**/Cargo.toml'
            - 'Cargo.lock'
            - 'rust-toolchain.toml'
            - '.taplo.toml'
            - '!.github/workflows/ci-js.yml'
env:
    NODE_VERSION: 22
jobs:
    lint-and-check:
        name: Lint and Check
        runs-on: ubuntu-latest
        steps:
            - uses: taiki-e/checkout-action@b13d20b7cda4e2f325ef19895128f7ff735c0b3d # v1.3.1
            - uses: actions/setup-node@a0853c24544627f65ddf259abe73b1d18a591444 # v5.0.0
              with:
                  node-version: ${{ env.NODE_VERSION }}
                  cache: 'yarn'

            - run: yarn --no-immutable
            - run: yarn lint --format github
            - run: yarn typecheck
              working-directory: napi/transform
